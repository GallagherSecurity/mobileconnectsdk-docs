<!DOCTYPE html>
<html lang="en">
  <head>
    <title>developer-guide  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="developer-guide  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html"> Docs</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html"> Reference</a>
        <img id="carat" src="img/carat.png" />
        developer-guide  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="developer-guide.html">developer-guide</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/DefaultNetworkServiceFactory.html">DefaultNetworkServiceFactory</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MobileAccessProvider.html">MobileAccessProvider</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Global%20Variables.html">Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Global%20Variables.html#/s:23GallagherMobileAccessNN35defaultNetworkServiceRequestTimeoutSdvp">defaultNetworkServiceRequestTimeout</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/AccessDecision.html">AccessDecision</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/AccessMode.html">AccessMode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/AuthenticationTokenError.html">AuthenticationTokenError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/CloudTlsValidationMode.html">CloudTlsValidationMode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/HttpMethod.html">HttpMethod</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/HttpStatusCode.html">HttpStatusCode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MobileAccessState.html">MobileAccessState</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MobileCredentialKeyStatus.html">MobileCredentialKeyStatus</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ReaderActionType.html">ReaderActionType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ReaderConnectionError.html">ReaderConnectionError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ReaderConnectionState.html">ReaderConnectionState</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ReaderDistance.html">ReaderDistance</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ReaderUpdateType.html">ReaderUpdateType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/RegistrationError.html">RegistrationError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/RequestFlags.html">RequestFlags</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SecondFactorAuthenticationType.html">SecondFactorAuthenticationType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SecondFactorVerificationType.html">SecondFactorVerificationType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:23GallagherMobileAccessNN2eeoiySbAA0C6ResultV_ADtF">==(_:_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/AccessDelegate.html">AccessDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ExtraData.html">ExtraData</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HttpDataResponse.html">HttpDataResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HttpJsonResponse.html">HttpJsonResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HttpResponse.html">HttpResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/JwtResultDelegate.html">JwtResultDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/MobileAccess.html">MobileAccess</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/MobileCredential.html">MobileCredential</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/NetworkService.html">NetworkService</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/NetworkServiceFactory.html">NetworkServiceFactory</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Reader.html">Reader</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ReaderAttributes.html">ReaderAttributes</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ReaderUpdateDelegate.html">ReaderUpdateDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RegistrationDelegate.html">RegistrationDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SdkStateDelegate.html">SdkStateDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/StringValueConvertible.html">StringValueConvertible</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/AccessResult.html">AccessResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/MobileAccessLocalization.html">MobileAccessLocalization</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/MobileCredentialStatus.html">MobileCredentialStatus</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ReaderAction.html">ReaderAction</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:23GallagherMobileAccessNN29AuthenticationDetailsProvidera">AuthenticationDetailsProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:23GallagherMobileAccessNN32CredentialDeleteCompletedHandlera">CredentialDeleteCompletedHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:23GallagherMobileAccessNN3Jwta">Jwt</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:23GallagherMobileAccessNN27NotificationDetailsProvidera">NotificationDetailsProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:23GallagherMobileAccessNN28ReaderActionCompletedHandlera">ReaderActionCompletedHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:23GallagherMobileAccessNN39ReaderActionEnumerationCompletedHandlera">ReaderActionEnumerationCompletedHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:23GallagherMobileAccessNN27RegistrationDetailsProvidera">RegistrationDetailsProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:23GallagherMobileAccessNN38SecondFactorAuthenticationTypeSelectora">SecondFactorAuthenticationTypeSelector</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='gallagher-mobile-connect-sdk-for-ios-developer-guide' class='heading'>Gallagher Mobile Connect SDK for iOS - Developer Guide</h1>
<h2 id='contents' class='heading'>Contents</h2>

<ul>
<li><a href="#prerequisites">Pre-requisites</a></li>
<li><a href="#gettingstarted">Getting Started</a></li>
<li><a href="#mobilecredentials">Mobile Credentials</a></li>
<li><a href="#readerdiscovery">Reader Discovery and Access</a></li>
<li><a href="#faq">Frequently Asked Questions</a></li>
<li><a href="#backgroundaccess">Background Access</a></li>
</ul>
<h2 id='pre-requisites-a-name-prerequisites-a' class='heading'>Pre-requisites<a name=prerequisites></a></h2>

<ul>
<li>Xcode 11 (This document tested against Xcode 11.0 build 1A420a)</li>
<li>An app targeting iOS 10 or later</li>
<li>Swift 5.1 - The functionality and interfaces provided by the SDK are swift; You must use swift to access them.</li>
<li>RxSwift (This document tested against RxSwift 5.0.1)</li>
</ul>
<h2 id='getting-started-a-name-gettingstarted-a' class='heading'>Getting Started<a name=gettingstarted></a></h2>
<h3 id='1-add-the-sdk-framework-to-your-project' class='heading'>1. Add the SDK framework to your project</h3>

<p>Unzip the zip file.</p>

<p>Add GallagherMobileAccess.framework to your Xcode project - The easiest way to do this is by dragging and dropping it from the Finder into the Xcode project navigator</p>

<p>Example:</p>

<p><img src="img/xcode-project-navigator-added-framework.png" alt="Xcode project navigator showing GallagherMobileAccess.framework"></p>

<p>You will also need to add <code>GallagherMobileAccess.framework</code> to the <strong>Embedded Binaries</strong> section of the <strong>General</strong> settings for your project.</p>
<h3 id='2-1-dependency-rxswift' class='heading'>2.1 Dependency: RxSwift</h3>

<p>The SDK uses RxSwift internally. </p>

<p><span style="text-decoration: line-through">You may install RxSwift via CocoaPods or Carthage if you use those, or if you would like to install it manually, use the following procedure:</span></p>

<ol>
<li><span style="text-decoration: line-through">Download <strong>RxSwift.framework.zip</strong> from <a href="https://github.com/ReactiveX/RxSwift/releases">https://github.com/ReactiveX/RxSwift/releases</a><br>
As-tested <a href="https://github.com/ReactiveX/RxSwift/releases/download/5.0.1/RxSwift.framework.zip">RxSwift 5.0.1 framework zip direct link</a> </span></li>
</ol>

<p><strong>NOTE:</strong> At the point in time of this document revision, RxSwift had not yet published an Xcode 11 compatible binary release. Gallagher provide a version of RxSwift 5.0.1 which you can use instead.
Our version is built using Xcode 11 using the same source revision (b3e888b) as the RxSwift 5.0.1 official release</p>

<ol>
<li>Unzip the zip file and <strong>RxSwift.framework</strong> to your project - The easiest way to do this is by dragging and dropping it from the Finder into the Xcode project navigator.
You can find RxSwift.framework under the <strong>Carthage/Build/iOS</strong> folder</li>
</ol>

<p><img src="img/xcode-project-navigator-added-rxswift.png" alt="Xcode project navigator showing RxSwift.framework"></p>

<p><img src="img/xcode-embedded-binaries.png" alt="Xcode project settings embedded binaries"></p>
<h3 id='2-2-if-upgrading-from-xcode-9-remove-dependency-on-fake-commoncrypto-framework' class='heading'>2.2 If upgrading from Xcode 9: Remove Dependency on fake CommonCrypto framework.</h3>

<p>In previous releases of the SDK, you needed to create a fake CommonCrypto framework, and add it to your Xcode swift compiler import paths.</p>

<p>In Xcode 10, Apple removed the need for the fake framework, but if you are upgrading an existing app from Xcode 9, you will most likely find it doesn&rsquo;t compile on Xcode 10 or later.
You need to delete the fake CommonCrypto framework and delete it from Xcode swift compiler import paths.</p>
<h3 id='3-configure-your-application-plist' class='heading'>3. Configure your application - Plist</h3>

<p>Add the following to your app&rsquo;s <code>Info.plist</code>:</p>
<pre class="highlight xml"><code><span class="nt">&lt;key&gt;</span>NSBluetoothPeripheralUsageDescription<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>Used to detect and connect to Gallagher Bluetooth® enabled readers for access.<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>NSBluetoothAlwaysUsageDescription<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>Used to detect and connect to Gallagher Bluetooth® enabled readers for access.<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>NSFaceIDUsageDescription<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>Use Face ID to access secure areas that require two factor authentication.<span class="nt">&lt;/string&gt;</span>
</code></pre>

<p>You may wish to customise the text.</p>
<h3 id='4-configure-the-mobile-connect-sdk-within-your-application' class='heading'>4. Configure the Mobile Connect SDK within your application.</h3>

<p>You must call the <code>MobileAccessProvider.configure()</code> method before first using the SDK.
<code>configure</code> may only be called once.</p>

<p>Thereafter you can gain access to the SDK using the static <code><a href="Classes/MobileAccessProvider.html#/s:23GallagherMobileAccessNN0bC8ProviderC8instanceAA0bC0_pvpZ">MobileAccessProvider.instance</a></code> method. If you attempt to access <code>instance</code> before <code>configure()</code> a fatal error will be thrown and your program will exit.</p>

<p>The configure method may be called with no arguments, or you may customise any of</p>

<ul>
<li><code>databaseFilePath</code>: Optional. The filesystem location at which the SDK stores it&rsquo;s internal SQLite database</li>
<li><code>localization</code>: Optional. Allows you to customise UI messages used by the SDK. See the <strong>Customising SDK messages</strong> section.</li>
</ul>

<p>Once the SDK is configured, you may want to call the <code>setScanning(enabled: true)</code> method to activate scanning for readers using Bluetooth Low Energy. Here is an example of an application which starts scanning and auto-connect upon launch.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">GallagherMobileAccess</span>

<span class="kd">@UIApplicationMain</span>
<span class="kd">class</span> <span class="kt">AppDelegate</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="p">,</span> <span class="kt">UIApplicationDelegate</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">mobileAccess</span><span class="p">:</span> <span class="kt">MobileAccess</span>

    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">mobileAccess</span> <span class="o">=</span> <span class="kt">MobileAccessProvider</span><span class="o">.</span><span class="nf">configure</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// ... other code ...</span>

    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="n">mobileAccess</span><span class="o">.</span><span class="n">isAutomaticAccessEnabled</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="n">mobileAccess</span><span class="o">.</span><span class="nf">setScanning</span><span class="p">(</span><span class="nv">enabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
</code></pre>

<p>At this point you should be able to compile and launch your app, and the <code>setScanning</code> method should not crash.
The SDK will not do anything however, until you register at least one mobile credential.</p>

<p><strong>Reference:</strong><br>
<a href="Classes/MobileAccessProvider.html">MobileAccessProvider</a><br>
<a href="Protocols/MobileAccess.html">MobileAccess</a>  </p>
<h2 id='mobile-credentials-a-name-mobilecredentials-a' class='heading'>Mobile Credentials<a name=mobilecredentials></a></h2>

<p>In order to gain access or communicate with readers over Bluetooth, you must first have a registered credential to authenticate your user and device.</p>

<p>Mobile credentials are created in Command Centre, either using the Command Centre Client, or via the Command Centre REST API.</p>

<p>For more information, see the REST API documentation regarding Creating Cards and Cardholders.</p>
<h3 id='1-registering-a-mobile-credential-a-name-registering-a' class='heading'>1. Registering a Mobile Credential<a name=registering></a></h3>

<p>You will need to obtain an invitation URL. If you are creating credentials using the REST API, you will also be able to use it to retrieve the invitation URL. Please refer to the server-side integration guide and REST api documentation for more information.</p>

<p>You can also build the invitation url using the <code>resolveInvitationUri</code> method in the Mobile Connect SDK.<br>
Given an invitation code, and the hostname of the Gallagher Cloud Server (<a href="https://commandcentre-ap-southeast-2.security.gallagher.cloud">https://commandcentre-ap-southeast-2.security.gallagher.cloud</a>) you may call this method to generate the invitation URL.</p>

<p>When getting started, the easiest option will most likely be to use the Command Centre client to send yourself an invitation via email, and use the invitation code from the <q>Manual Registration</q> section of the standard Gallagher invitation email message.</p>

<p>If you do this, be sure to create a new Mobile Credential Card Type, and untick the <q>Send SMS Verification Code</q> option for the Mobile Credential Card Type.<br>
<strong>SMS verification is not supported for third-party apps using the Mobile Connect SDK.</strong></p>

<p><img src="img/mobile-credential-cardtype-no-sms.png" alt="Mobile Credential Configuration screenshot"></p>

<p>Once you have obtained the invitation URL, use the <code>registerCredential(URL, RegistrationDelegate)</code> method to begin the registration process. The SDK will asynchronously call the callback methods on the <code><a href="Protocols/RegistrationDelegate.html">RegistrationDelegate</a></code> to inform you of success or failure. Callbacks will arrive on the main thread.</p>

<p>There is also an overload to the <code>registerCredential</code> method which accepts two callback functions, rather than a single RegistrationDelegate object, which may be more convenient.</p>

<p><em>Example:</em></p>
<pre class="highlight swift"><code><span class="k">guard</span> <span class="k">let</span> <span class="nv">invitationUrl</span> <span class="o">=</span> <span class="n">mobileAccess</span><span class="o">.</span><span class="nf">resolveInvitationUrl</span><span class="p">(</span><span class="n">serverHost</span><span class="p">,</span> <span class="nv">invitation</span><span class="p">:</span> <span class="n">invitationCode</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

<span class="c1">// using callback overload, rather than delegate directly</span>
<span class="n">mobileAccess</span><span class="o">.</span><span class="nf">registerCredential</span><span class="p">(</span>
    <span class="nv">url</span><span class="p">:</span> <span class="n">invitationUrl</span><span class="p">,</span>
    <span class="nv">onRegistrationCompleted</span><span class="p">:</span> <span class="p">{</span> <span class="n">credential</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
            <span class="nf">toast</span><span class="p">(</span><span class="s">"Registration Error </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nf">toast</span><span class="p">(</span><span class="s">"Registered!"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nv">onAuthenticationTypeSelectionRequested</span><span class="p">:</span> <span class="p">{</span> <span class="n">selector</span> <span class="k">in</span>
        <span class="c1">// If the credential allows for second-factor authentication, then we need </span>
        <span class="c1">// to ask the user which method they'd prefer; Fingerprint or PIN?</span>

        <span class="c1">// pop a dialog here and ask the user their preference</span>
        <span class="k">let</span> <span class="nv">userChoice</span> <span class="o">=</span> <span class="o">.</span><span class="n">pin</span>
        <span class="nf">selector</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">userChoice</span><span class="p">)</span>
    <span class="p">})</span>
</code></pre>

<p>For a comprehensive example, please see the file <code>RegistrationsViewController.swift</code> in the iOS SDK sample application.</p>

<p><strong>Reference:</strong><br>
<a href="Protocols/MobileAccess.html">MobileAccess</a><br>
<a href="Protocols/RegistrationDelegate.html">RegistrationDelegate</a><br>
<a href="Protocols/MobileCredential.html">MobileCredential</a><br>
<a href="Typealiases.html#/s:23GallagherMobileAccessNN38SecondFactorAuthenticationTypeSelectora">SecondFactorAuthenticationTypeSelector</a><br>
<a href="Enums/SecondFactorAuthenticationType.html">SecondFactorAuthenticationType</a>  </p>
<h3 id='2-a-name-listcredentials-a-listing-registered-credentials' class='heading'>2. <a name=listcredentials></a>Listing Registered Credentials</h3>

<p>Use the <code>mobileCredentials</code> property. This will return an array of <code><a href="Protocols/MobileCredential.html">MobileCredential</a></code> - which you should copy into your own array or other stable collection.</p>

<p><a href="Protocols/MobileAccess.html">MobileAccess</a><br>
<a href="Protocols/MobileCredential.html">MobileCredential</a>  </p>
<h3 id='3-a-name-deregistering-a-deleting-a-mobile-credential' class='heading'>3. <a name=deregistering></a>Deleting a Mobile Credential</h3>

<p>Use the <code>deleteMobileCredential(MobileCredential, CredentialDeleteCompletedHandler)</code> method. The SDK will asynchronously call the completion lambda  <code><a href="Typealiases.html#/s:23GallagherMobileAccessNN32CredentialDeleteCompletedHandlera">CredentialDeleteCompletedHandler</a></code> to inform you of success or failure. Callbacks will arrive on the main thread.</p>

<p>You can obtain a reference to the credential object to delete by getting <code>mobileCredentials</code>. Mobile Credential objects have an <code>id</code> which you should use if you wish to compare instances.</p>

<p><em>Example:</em></p>
<pre class="highlight swift"><code>
<span class="n">mobileAccess</span><span class="o">.</span><span class="nf">deleteMobileCredential</span><span class="p">(</span><span class="n">credential</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">credential</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="nf">toast</span><span class="p">(</span><span class="s">"Error deleting credential </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nf">toast</span><span class="p">(</span><span class="s">"Deleted!"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>

<p>For a comprehensive example, please see the file <code>RegistrationsViewController.swift</code> in the iOS SDK sample application.</p>

<p><a href="Protocols/MobileAccess.html">MobileAccess</a><br>
<a href="Typealiases.html#/s:23GallagherMobileAccessNN32CredentialDeleteCompletedHandlera">CredentialDeleteCompletedHandler</a><br>
<a href="Protocols/MobileCredential.html">MobileCredential</a>  </p>
<h2 id='reader-discovery-and-access-a-name-readerdiscovery-a' class='heading'>Reader Discovery and Access<a name=readerdiscovery></a></h2>

<hr>
<h3 id='1-tracking-whether-the-sdk-is-working-or-not' class='heading'>1. Tracking whether the SDK is working or not</h3>

<p>There are a variety of reasons why the SDK may not work even though you have called <code>setScanning(enabled: true)</code>, such as Bluetooth being disabled in your device system settings, lack of permissions, etc.</p>

<p>You should use the <code>addSdkStateDelegate(SdkStateDelegate)</code> method. The SDK will asynchronously call the callback methods on the <code><a href="Protocols/SdkStateDelegate.html">SdkStateDelegate</a></code> to inform you of state changes. Callbacks will arrive on the main thread.</p>

<p>You may wish to log these state changes, or prompt the user to perform some action (such as granting permissions, or giving them a button to click to enable Bluetooth, etc)</p>

<p><em>Example:</em></p>
<pre class="highlight swift"><code><span class="n">mobileAccess</span><span class="o">.</span><span class="nf">addSdkStateDelegate</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
<span class="c1">// ...</span>
<span class="kd">func</span> <span class="nf">onStateChange</span><span class="p">(</span><span class="nv">isScanning</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">,</span> <span class="nv">states</span><span class="p">:</span> <span class="p">[</span><span class="kt">MobileAccessState</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">messages</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>

    <span class="k">for</span> <span class="n">state</span> <span class="k">in</span> <span class="n">states</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">state</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">noCredentials</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Please register a credential"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">noPasscodeSet</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Please set a passcode on your device"</span><span class="p">)</span>
        <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// display messages in a TableView for example</span>
<span class="p">}</span>
</code></pre>

<p><strong>Reference:</strong><br>
<a href="Protocols/MobileAccess.html">MobileAccess</a><br>
<a href="Protocols/SdkStateDelegate.html">SdkStateDelegate</a><br>
<a href="Enums/MobileAccessState.html">MobileAccessState</a>  </p>
<h3 id='2-auto-connect' class='heading'>2. Auto-connect</h3>

<p>You must set the <code>isAutomaticAccessEnabled</code> property to <code>true</code> in order to enable auto-connect. You can set it to <code>false</code> to disable it later if you require.<br>
Note that enabling and disabling automatic access does not affect bluetooth scanning, which continues until you call <code>setScanning(enabled: false)</code></p>

<p>By default, the Mobile Connect SDK will automatically attempt to connect to any nearby readers if the device enters the configured range.</p>

<p>If you wish to be informed about auto connect events, use the <code>addAutomaticAccessDelegate(AccessDelegate)</code> method. The SDK will asynchronously call the callback methods on the <code><a href="Protocols/AccessDelegate.html">AccessDelegate</a></code> to inform you of success or failure. Callbacks will arrive on the main thread.</p>

<p>Any calls to <code>addAutomaticAccessDelegate</code> should be balanced by a call to <code>removeAutomaticAccessDelegate</code> to prevent memory leaks.</p>

<p><em>Example:</em></p>
<pre class="highlight swift"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
    <span class="n">mobileAccess</span><span class="o">.</span><span class="nf">addAutomaticAccessDelegate</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">deinit</span> <span class="p">{</span>
    <span class="n">mobileAccess</span><span class="o">.</span><span class="nf">removeAutomaticAccessDelegate</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="kd">func</span> <span class="nf">onAccessStarted</span><span class="p">(</span><span class="nv">reader</span><span class="p">:</span> <span class="kt">Reader</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">updateDisplayState</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="o">.</span><span class="n">active</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">onAccessCompleted</span><span class="p">(</span><span class="nv">reader</span><span class="p">:</span> <span class="kt">Reader</span><span class="p">,</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">AccessResult</span><span class="p">?,</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">ReaderConnectionError</span><span class="p">?)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nf">updateDisplayState</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="o">.</span><span class="n">failed</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">accessResult</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
        <span class="nf">updateDisplayState</span><span class="p">(</span>
            <span class="n">reader</span><span class="p">,</span> 
            <span class="n">result</span><span class="o">.</span><span class="nf">isAccessGranted</span><span class="p">()</span> <span class="p">?</span> <span class="o">.</span><span class="nv">succeeded</span> <span class="p">:</span> <span class="o">.</span><span class="n">failed</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>

<p><strong>Reference:</strong><br>
<a href="Protocols/MobileAccess.html">MobileAccess</a><br>
<a href="Protocols/AccessDelegate.html">AccessDelegate</a><br>
<a href="Protocols/Reader.html">Reader</a><br>
<a href="Classes/AccessResult.html">AccessResult</a><br>
<a href="Enums/ReaderConnectionError.html">ReaderConnectionError</a>  </p>
<h3 id='3-discovery-of-readers' class='heading'>3. Discovery of readers</h3>

<p>Call the <code>addReaderUpdateDelegate</code> method to provide a <code><a href="Protocols/ReaderUpdateDelegate.html">ReaderUpdateDelegate</a></code> object to be called when a reader is discovered via Bluetooth.</p>

<p>If you wish to show an interactive list of nearby readers in your application, you can use this to maintain a list of readers and other related information (such as visual state, appearance, etc) and display that information.</p>

<p>If your app only wants to use the auto-connect feature of the Mobile Connect SDK, then you can skip this section; The SDK will work regardless of whether you call <code>addReaderUpdateDelegate</code></p>

<p><em>Example:</em></p>
<pre class="highlight swift"><code><span class="c1">//...</span>
<span class="n">mobileAccess</span><span class="o">.</span><span class="nf">addReaderUpdateDelegate</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
<span class="c1">//...</span>

<span class="kd">func</span> <span class="nf">onReaderUpdated</span><span class="p">(</span><span class="n">_</span> <span class="nv">reader</span><span class="p">:</span> <span class="kt">ReaderAttributes</span><span class="p">,</span> <span class="nv">updateType</span><span class="p">:</span> <span class="kt">ReaderUpdateType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">updateType</span> <span class="o">==</span> <span class="o">.</span><span class="n">attributesChanged</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">idx</span> <span class="o">=</span> <span class="n">readers</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">reader</span><span class="o">.</span><span class="n">id</span> <span class="p">})</span> <span class="p">{</span>
            <span class="nf">replaceReaderInList</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// a new reader</span>
            <span class="nf">addReaderToList</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">updateType</span> <span class="o">==</span> <span class="o">.</span><span class="n">readerUnavailable</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">idx</span> <span class="o">=</span> <span class="n">readers</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">reader</span><span class="o">.</span><span class="n">id</span> <span class="p">})</span> <span class="p">{</span>
            <span class="nf">removeReaderFromList</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>For a full example, refer to <code>ReadersViewController.swift</code> in the SDK sample app, specifically the <code>onReaderUpdated</code> method of the <code>ReadersViewController</code>.</p>

<p><strong>Reference:</strong><br>
<a href="Protocols/MobileAccess.html">MobileAccess</a><br>
<a href="Protocols/ReaderUpdateDelegate.html">ReaderUpdateDelegate</a><br>
<a href="Protocols/ReaderAttributes.html">ReaderAttributes</a><br>
<a href="Enums/ReaderUpdateType.html">ReaderUpdateType</a>  </p>
<h3 id='4-manual-connect' class='heading'>4. Manual Connect</h3>

<p>Once you have discovered a reader, you can manually initiate an access request using the <code>requestAccess(Reader, AccessDelegate)</code> method. The SDK will asynchronously call the callback methods on the <code><a href="Protocols/AccessDelegate.html">AccessDelegate</a></code> to inform you of success or failure. Callbacks will arrive on the main thread.</p>

<p><em>Example:</em></p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">onReaderClicked</span><span class="p">(</span><span class="nv">reader</span><span class="p">:</span> <span class="kt">Reader</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">mobileAccess</span><span class="o">.</span><span class="nf">requestAccess</span><span class="p">(</span><span class="nv">reader</span><span class="p">:</span> <span class="n">reader</span><span class="p">,</span> <span class="nv">delegate</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// ...</span>
<span class="kd">func</span> <span class="nf">onAccessStarted</span><span class="p">(</span><span class="nv">reader</span><span class="p">:</span> <span class="kt">Reader</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">updateDisplayState</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="o">.</span><span class="n">active</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">onAccessComplete</span><span class="p">(</span><span class="nv">reader</span><span class="p">:</span> <span class="kt">Reader</span><span class="p">,</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">AccessResult</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">updateDisplayState</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="o">.</span><span class="n">succeeded</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">onAccessError</span><span class="p">(</span><span class="nv">reader</span><span class="p">:</span> <span class="kt">Reader</span><span class="p">,</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">ReaderConnectionError</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">updateDisplayState</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="o">.</span><span class="n">failed</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>For a full example, refer to <code>ReadersViewController.swift</code> in the SDK sample app, specifically the above-named methods in the <code>ReadersViewController</code> class</p>

<p><strong>Reference:</strong><br>
<a href="Protocols/MobileAccess.html">MobileAccess</a><br>
<a href="Protocols/Reader.html">Reader</a><br>
<a href="Classes/AccessResult.html">AccessResult</a><br>
<a href="Enums/ReaderConnectionError.html">ReaderConnectionError</a></p>
<h2 id='5-actions-overrides' class='heading'>5. Actions/Overrides</h2>

<p>If the readers are configured to support it, the Mobile Connect SDK can ask the reader to perform actions such as overriding to Arm/Disarm the alarm zone, locking or unlocking, or toggling configured outputs.</p>

<p>This is a two step process. First you must request the list of available actions, and then you must request to perform the specific action.</p>
<h3 id='5-1-enumerating-the-list-of-available-actions' class='heading'>5.1 Enumerating the list of available actions</h3>

<p>Use the <code>enumerateReaderActions(Reader, ReaderActionEnumerationCompletedHandler)</code> method. The SDK will asynchronously call the completion lambda <code><a href="Typealiases.html#/s:23GallagherMobileAccessNN39ReaderActionEnumerationCompletedHandlera">ReaderActionEnumerationCompletedHandler</a></code> to inform you of success or failure. Callbacks will arrive on the main thread.</p>

<p><em>Example:</em></p>
<pre class="highlight swift"><code>
<span class="n">mobileAccess</span><span class="o">.</span><span class="nf">enumerateReaderActions</span><span class="p">(</span><span class="nv">reader</span><span class="p">:</span> <span class="n">reader</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="nf">toast</span><span class="p">(</span><span class="s">"enumerateReaderActions failed: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">actions</span> <span class="o">=</span> <span class="n">actions</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">actions</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="nf">toast</span><span class="p">(</span><span class="s">"No actions available"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="nf">showListOfAvailableActions</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p><strong>Reference:</strong><br>
<a href="Protocols/MobileAccess.html">MobileAccess</a><br>
<a href="Typealiases.html#/s:23GallagherMobileAccessNN39ReaderActionEnumerationCompletedHandlera">ReaderActionEnumerationCompletedHandler</a><br>
<a href="Protocols/Reader.html">Reader</a><br>
<a href="Protocols/ReaderAction.html">ReaderAction</a><br>
<a href="Enums/ReaderConnectionError.html">ReaderConnectionError</a>  </p>
<h3 id='5-2-performing-an-action' class='heading'>5.2 Performing an action</h3>

<p>Use the <code>requestReaderAction(Reader, ReaderAction, ReaderActionCompletedHandler)</code> method to perform a specific action. . The SDK will asynchronously call the completion lambda <code><a href="Typealiases.html#/s:23GallagherMobileAccessNN28ReaderActionCompletedHandlera">ReaderActionCompletedHandler</a></code> to inform you of success or failure. Callbacks will arrive on the main thread.</p>

<p><em>Example:</em></p>
<pre class="highlight swift"><code><span class="c1">// The ReaderAction object comes from the enumeration step</span>
<span class="n">mobileAccess</span><span class="o">.</span><span class="nf">requestReaderAction</span><span class="p">(</span><span class="nv">reader</span><span class="p">:</span> <span class="n">reader</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="n">action</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="nf">toast</span><span class="p">(</span><span class="s">"action error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nf">toast</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s"> succeeded"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>

<p>For a full example, refer to <code>ReadersViewController.swift</code> in the SDK sample app, specifically the above-named methods in <code>ReadersViewController</code> mentioned above.</p>

<p><a href="Protocols/MobileAccess.html">MobileAccess</a><br>
<a href="Typealiases.html#/s:23GallagherMobileAccessNN28ReaderActionCompletedHandlera">ReaderActionCompletedHandler</a><br>
<a href="Protocols/Reader.html">Reader</a><br>
<a href="Protocols/ReaderAction.html">ReaderAction</a><br>
<a href="Enums/ReaderConnectionError.html">ReaderConnectionError</a>  </p>
<h2 id='frequently-asked-questions-a-name-faq-a' class='heading'>Frequently Asked Questions<a name=faq></a></h2>
<h3 id='1-why-does-the-device-need-a-passcode-enabled' class='heading'>1. Why does the device need a passcode enabled?</h3>

<p>If a user attempts to register a mobile credential on an Apple device which does not have a passcode enabled, the registration operation will fail.</p>

<p>This is due to a technical implementation detail and is to improve security.</p>

<p>Internally, the Mobile Connect SDK stores two FIDO credentials for each site.</p>

<ol>
<li>The first-factor credential doesn&rsquo;t require any user-interaction, and is used when the Command Centre Access Zone is not in PINs mode.</li>
<li>The second-factor credential requires the mobile device user to input either a PIN or their fingerprint/face, and is used when the Command Centre access zone is in PINs mode.</li>
</ol>

<p>The second-factor credential needs to be more secure, because zones in PINs mode typically have much higher physical security requirements. As such, the Mobile Connect SDK requests that Apple performs additional encryption on the keys associated with second-factor credentials. This is implemented in iOS by using the passcode feature, which is why credential registration requires a passcode to be enabled.</p>

<p>Note that if a user registers, then turns off their passcode, the second-factor keys will be invalidated. They will be able to authenticate against readers where the Access Zone is not in PINs mode, however if they attempt to authenticate where second factor is required, they will fail. The only available solution is for that user to re-enable their passcode, then repeat the registration process.</p>
<h2 id='background-access-a-name-backgroundaccess-a' class='heading'>Background Access<a name=backgroundaccess></a></h2>

<p>By default, the SDK will continuously scan for and connect to Bluetooth enabled readers while it is running in the foreground. This is the standard behaviour for iOS applications.</p>

<p>If you would like it to only scan (for example) when a particular ViewController is on-screen, then you should use the <code>setScanning</code> method to control this.</p>

<p>If you would like the SDK to scan for readers while it is <em>not</em> visible in the foreground, you will need to enable background access. </p>

<p>There are two <q>levels</q> of background access functionality</p>
<h3 id='1-standard-background-access' class='heading'>1. Standard background access.</h3>

<p>This employs the default Apple Core Bluetooth background processing behaviour, as determined by Apple. This behaviour may (and has in the past) change between iOS versions. For more information refer to <a href="https://developer.apple.com/library/content/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetoothBackgroundProcessingForIOSApps/PerformingTasksWhileYourAppIsInTheBackground.html">Apple&rsquo;s Core Bluetooth Background Processing Documentation</a></p>

<p>Enabling standard background access requires no code changes.<br>
Add the following to your app&rsquo;s <code>Info.plist</code></p>
<pre class="highlight xml"><code><span class="nt">&lt;key&gt;</span>UIBackgroundModes<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;array&gt;</span>
    <span class="nt">&lt;string&gt;</span>bluetooth-central<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/array&gt;</span>
</code></pre>

<p>Unfortunately, in iOS 10 and 11, Apple aggressively throttle background scanning in order to conserve battery life. 
The observed behaviour of <q>standard</q> background access on an iOS 10 or 11 phone is generally that nothing appears to happen when the app is not in the foreground, however you can usually <q>trigger</q> background access as follows:</p>

<ol>
<li>Lock the phone screen</li>
<li>Approach and place your phone next to a reader</li>
<li>Turn the phone screen on - The act of turning the phone screen on seems to trigger apple&rsquo;s background behaviour</li>
</ol>

<p>As per apple&rsquo;s documentation, even when your app is running in the background iOS may kill it after some time. The exact rules around when and if iOS will kill it vary and change over time, but generally if you make heavy use of your phone, you can expect iOS to kill it more quickly in order to free up resources for other apps.</p>
<h3 id='2-extended-background-access' class='heading'>2. Extended background access.</h3>

<p>The Mobile Connect SDK offers an improved ability to scan for readers in the background, however this requires your app to request use of Background Location services. The SDK does not actually use or monitor the user&rsquo;s location at all, but the permission is required to enable the extended scanning mode.</p>

<p>To enable this, you must do the following</p>

<ol>
<li><p>Set the SDK&rsquo;s <code>backgroundScanningMode</code> property to <code>.extended</code></p></li>
<li><p>Enable iOS background location services as according to <a href="https://developer.apple.com/documentation/corelocation/choosing_the_authorization_level_for_location_services/requesting_always_authorization">Apple&rsquo;s Requesting Always Authorization</a> documentation. In summary - use <code>CLLocationManager.requestAlwaysAuthorization()</code>, and add the required keys to your Info.plist</p></li>
</ol>

<p><em>Example:</em></p>
<pre class="highlight xml"><code><span class="nt">&lt;key&gt;</span>NSLocationAlwaysUsageDescription<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>Your location is needed to detect readers using Bluetooth®. GPS is not used and your location is never shared.<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>NSLocationAlwaysAndWhenInUseUsageDescription<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>Your location is needed to detect readers using Bluetooth®. GPS is not used and your location is never shared.<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>NSLocationWhenInUseUsageDescription<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>Your location is needed to detect readers using Bluetooth®. GPS is not used and your location is never shared.<span class="nt">&lt;/string&gt;</span>
...
<span class="nt">&lt;key&gt;</span>UIBackgroundModes<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;array&gt;</span>
    <span class="nt">&lt;string&gt;</span>location<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string&gt;</span>bluetooth-central<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/array&gt;</span>
</code></pre>

<p>The observed behaviour of <q>standard</q> background access on an iOS 10 or 11 phone is generally that access works regardless of whether the app is visible or the screen is powered on or off, <em>however</em> iOS will still kill the app periodically if it is in the background for a period of time.</p>

<p>Extended background scanning also uses more battery - causing a roughly (with large margin of error) 10% additional drop in battery life over a work-day period.</p>
<h3 id='3-background-access-notifications' class='heading'>3. Background Access Notifications</h3>

<p>If the SDK determines that we are within auto-connect range of a reader, but that reader requires second factor authorisation, it will display a Notification asking the user to open the App.</p>

<p>This is required because second factor authorisation involves asking the user for a passcode or fingerprint, which isn&rsquo;t possible unless the App is visible in the foreground.</p>

<p>By default however, iOS does not allow notifications unless the user grants permission. You can request permission using the following code snippet:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">notificationSettings</span> <span class="o">=</span> <span class="kt">UIUserNotificationSettings</span><span class="p">(</span><span class="nv">types</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">alert</span><span class="p">,</span> <span class="o">.</span><span class="n">badge</span><span class="p">,</span> <span class="o">.</span><span class="n">sound</span><span class="p">],</span> <span class="nv">categories</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">registerUserNotificationSettings</span><span class="p">(</span><span class="n">notificationSettings</span><span class="p">)</span>
</code></pre>

<p>For a full example, refer to <code>AppDelegate.swift</code> in the SDK sample app, specifically the <code>enableExtendedBackgroundScanning()</code> method</p>

<p><strong>IMPORTANT! App Store Review Information:</strong> If you wish to publish an app to the App Store which has <q>always</q> background location scanning privileges, Apple&rsquo;s App-review team take this  seriously. You may need to provide sufficient documentation explaning exactly what and why the background location tracking is used for, and you must demonstrate that you have implemented the proper permission checks according to Apple&rsquo;s documentation. Apple may contact you to discuss this.</p>

<p>For example, in order to get App review approval for Gallagher&rsquo;s mobile connect application, we were required to submit a video of the app being used in the background, and they contacted us via the phone to discuss and understand the feature.</p>

<p>We are required to place the following text in our app&rsquo;s description in the app store:  </p>

<blockquote>
<p>Continued use of GPS running in the background can dramatically decrease battery life.</p>
</blockquote>

<p>We also place the following text in our App review notes in itunes connect, which we find helps prevent accidental rejection:</p>

<blockquote>
<p>The app uses Background location updates to enable scanning for bluetooth readers while the app is in the background</p>

<p>As previously requested by app review, we have implemented the proper permission check with appropriate description (shown in the video when enabling background scanning) and added the required disclaimer about background location affecting battery life to the app description.</p>

<p>If the user does not grant background location permissions to the app, it detects this, and the <q>Backgound Scanning</q> setting remains off. The app will continue to work correctly in the foreground</p>

<p>If the user subsequently wants to turn background scanning on, but has previously denied location permissions, the app will detect this and offer to open the iOS Settings app so they can manually grant the location permissions.</p>
</blockquote>
<h2 id='troubleshooting-customising-the-sdk' class='heading'>Troubleshooting / Customising the SDK</h2>
<h3 id='1-configuring-logging-optional' class='heading'>1. Configuring logging (optional)</h3>

<p>If you encounter unexpected errors or behaviour, you may wish to enable logging from the SDK to help with troubleshooting.</p>

<p>By default, the SDK will not log anything.
To enable logging, you have two options:</p>

<ol>
<li><p>Construct a <code>LogConfiguration(fileURL: aFileUrl)</code> struct, and assign it to static the <code>Log.configuration</code> property. This will cause the SDK to write it&rsquo;s log output to the given file. You are responsible for creating any subdirectories or otherwise making the file available.</p></li>
<li><p>Construct a <code>LogConfiguration(externalWriter: LogWriter)</code> struct, and assign it to static the <code>Log.configuration</code> property. When the SDK wishes to log something, it will invoke <code>write(level: LogLevel, message: () -&gt; String, parameters: LogParameters)</code> method on the externalWriter.</p></li>
</ol>

<p>For more information, please refer to the SwiftDocs</p>

<p>For an example, please see the file <code>AppDelegate.swift</code> in the iOS SDK sample application, which redirects the SDK&rsquo;s internal logging to the system-wide <code>os_log</code> infrastructure.</p>
<h3 id='2-customising-sdk-messages' class='heading'>2. Customising SDK messages</h3>

<p>The SDK will at times need to prompt the user for information, such as to enter their fingerprint or passcode. By default the SDK will generate messages in English, however you have the ability to alter these messages - either to simply change the message text to better suit your application, or to translate it into other languages.</p>

<p>To achieve this, you can pass a custom <code><a href="Structs/MobileAccessLocalization.html">MobileAccessLocalization</a></code> object to the <code>MobileAccess.configure()</code> method as part of configuring the SDK. You should do this once, at application startup, or before your first use of the SDK.</p>

<p>The <code><a href="Structs/MobileAccessLocalization.html">MobileAccessLocalization</a></code> object has three properties which are callback functions. The SDK will invoke these callback functions so you may generate the appropriate message text. This is best explained by example:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">loc</span> <span class="o">=</span> <span class="kt">MobileAccessLocalization</span><span class="p">(</span>
    <span class="nv">notificationDetails</span><span class="p">:</span> <span class="p">{</span> <span class="n">reader</span> <span class="nf">in</span> <span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Open App!"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="s">"Accessing </span><span class="se">\(</span><span class="n">reader</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="p">},</span>
    <span class="nv">registrationDetails</span><span class="p">:</span> <span class="p">{</span> <span class="n">siteName</span> <span class="k">in</span> <span class="s">"Register: </span><span class="se">\"\(</span><span class="n">siteName</span><span class="se">)\"</span><span class="s">"</span> <span class="p">},</span>
    <span class="nv">authenticationDetails</span><span class="p">:</span> <span class="p">{</span> <span class="n">readerName</span> <span class="k">in</span> <span class="s">"Authenticate: </span><span class="se">\"\(</span><span class="n">readerName</span><span class="se">)\"</span><span class="s">"</span> <span class="p">})</span>

<span class="n">mobileAccess</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">localization</span><span class="p">:</span> <span class="n">loc</span><span class="p">)</span>
</code></pre>

<p>All properties are optional</p>

<p><strong>Reference:</strong>
<a href="Structs/MobileAccessLocalization.html">MobileAccessLocalization</a>  </p>
<h4 id='2-1-notificationdetails' class='heading'>2.1. notificationDetails</h4>

<p>If your application uses the background access feature of the Mobile Connect SDK, then when the user encounters a reader that is configured to require a second factor, they will need to open the App in order to complete the request. (For example, You can&rsquo;t prompt someone for their fingerprint when your app isn&rsquo;t on-screen)</p>

<p>In order to facilite this, the SDK will show a Local Notification asking the user to open the app. When the SDK wants to show this notification, it will call the <code>notificationDetails</code> localization callback.</p>

<p>The callback will be passed the name of the Bluetooth Reader that they are connecting to, and must return a tuple of <code>(title: String, body: String)</code>. The <code>title</code> is used for the first line of the notification message (in bold text) and the <code>body</code> is used for the subsequent lines of the notification message. The notification will display your app&rsquo;s icon.</p>

<p>If you do not provide a notificationDetails callback, the SDK will default to a callback which is the equivalent of:</p>
<pre class="highlight swift"><code><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="s">"Open App for </span><span class="se">\(</span><span class="n">reader</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
</code></pre>

<p><strong>Reference:</strong><br>
<a href="Typealiases.html#/s:23GallagherMobileAccessNN27NotificationDetailsProvidera">NotificationDetailsProvider</a>  </p>
<h4 id='2-2-registrationdetails' class='heading'>2.2 registrationDetails</h4>

<p>When the user registers a mobile credential, the SDK will ask them for either their Passcode or Fingerprint/Face ID, as per the <a href="#registration">registration</a> section earlier in this document.</p>

<p>The SDK will show Apple&rsquo;s system user interface for Fingerprint/Passcode/Face ID, which allows a single custom line of text. It is useful to show the site name on this screen so the user knows what they are registering for.</p>

<p>The callback will be passed the name of the site (as known to the Gallagher Cloud), and should return a message to show on this registration screen.</p>

<p>If you do not provide a registrationDetails callback, the SDK will default to the equivalent of:</p>
<pre class="highlight swift"><code><span class="s">"Register for </span><span class="se">\"\(</span><span class="n">siteName</span><span class="se">)\"</span><span class="s">"</span>
</code></pre>

<p><strong>Reference:</strong><br>
<a href="Typealiases.html#/s:23GallagherMobileAccessNN27RegistrationDetailsProvidera">RegistrationDetailsProvider</a>  </p>
<h4 id='2-3-authenticationdetails' class='heading'>2.3 authenticationDetails</h4>

<p>When the user attempts to access a door that requires second factor authentication, the SDK will ask them for either their Passcode or Fingerprint/Face ID - whatever they chose when they previously registered their credential.</p>

<p>The SDK will show Apple&rsquo;s system user interface for Fingerprint/Passcode/Face ID, which allows a single custom line of text. It is useful to the reader name on this screen so the user knows what they are authenticating for.</p>

<p>The callback will be passed the name of the reader, and should return a message to show on this authentication screen.</p>

<p>If you do not provide a authenticationDetails callback, the SDK will default to the equivalent of:</p>
<pre class="highlight swift"><code><span class="s">"Authenticate for </span><span class="se">\"\(</span><span class="n">readerName</span><span class="se">)\"</span><span class="s">"</span>
</code></pre>

<p><strong>Reference:</strong><br>
<a href="Typealiases.html#/s:23GallagherMobileAccessNN29AuthenticationDetailsProvidera">AuthenticationDetailsProvider</a>  </p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2020 <a class="link" href="" target="_blank" rel="external"></a>. All rights reserved. (Last updated: 2020-03-18)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.11.1</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
